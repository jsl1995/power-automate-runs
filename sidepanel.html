<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Run History</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>

<body>
  <div class="container">
    <header>
      <h1 id="panel-title">Run History</h1>
      <div class="header-actions">
        <div id="export-dropdown" class="export-dropdown hidden">
          <button id="export-menu-btn" class="export-menu-btn" aria-expanded="false" aria-haspopup="true" title="Export">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 12l-4-4h2.5V3h3v5H12L8 12z"/>
              <path d="M14 14H2v-3h1v2h10v-2h1v3z"/>
            </svg>
            <svg class="export-caret" width="10" height="10" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M4 6l4 4 4-4"/>
            </svg>
          </button>
          <div id="export-menu" class="export-menu hidden" role="menu">
            <button id="export-runs-btn" class="export-menu-item" role="menuitem">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M2 2h12v2H2V2zm0 4h12v2H2V6zm0 4h9v2H2v-2z"/>
              </svg>
              Run History
            </button>
            <button id="export-flow-btn" class="export-menu-item" role="menuitem">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M5 1h5l4 4v9a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
                <path d="M9 1v4h4" fill="none" stroke="currentColor" stroke-width="1"/>
              </svg>
              Flow Definition JSON
            </button>
          </div>
        </div>
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
          <svg class="theme-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path d="M9.5 1.5A5.5 5.5 0 1 0 14.5 10a.5.5 0 0 0-.7-.6A4 4 0 0 1 9.1 2.2.5.5 0 0 0 9.5 1.5z" />
          </svg>
        </button>
        <button id="refresh-btn" class="refresh-btn" aria-label="Refresh run history">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
            <path d="M13.65 2.35A8 8 0 1 0 16 8h-2a6 6 0 1 1-1.76-4.24L10 6h6V0l-2.35 2.35z" />
          </svg>
        </button>
      </div>
    </header>

    <div id="back-to-editor" class="back-to-editor hidden">
      <button id="back-btn" class="back-btn" aria-label="Return to Flow Editor">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
          <path d="M11 2L5 8l6 6V2z" />
        </svg>
        <span>Return to Flow Editor</span>
      </button>
    </div>

    <div id="content" role="main" aria-live="polite">
      <div id="loading" class="state">
        <div class="spinner" role="status" aria-label="Loading"></div>
        <p>Loading runs...</p>
      </div>

      <div id="no-flow" class="state hidden">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <path d="M9 17H7A5 5 0 0 1 7 7h2M15 7h2a5 5 0 0 1 0 10h-2M8 12h8" />
        </svg>
        <p>Navigate to a Power Automate flow to view run history</p>
      </div>

      <div id="error" class="state hidden" role="alert">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d13438" stroke-width="1.5" aria-hidden="true">
          <circle cx="12" cy="12" r="10" />
          <path d="M12 8v4M12 16h.01" />
        </svg>
        <p id="error-message">An error occurred</p>
        <button id="retry-btn" class="retry-btn">Retry</button>
      </div>

      <div id="runs-list" class="hidden" role="list"></div>

      <div id="no-runs" class="state hidden">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <rect x="3" y="4" width="18" height="16" rx="2" />
          <path d="M7 8h10M7 12h6" />
        </svg>
        <p>No runs found for this flow</p>
      </div>

      <div id="powerapps-redirect" class="state hidden">
        <svg width="48" height="48" viewBox="0 0 96 96" fill="none" aria-hidden="true">
          <path d="M48 12L84 36V60L48 84L12 60V36L48 12Z" fill="#742774" />
          <path d="M48 12L84 36L48 48L12 36L48 12Z" fill="#A4509A" />
          <path d="M48 48V84L12 60V36L48 48Z" fill="#8C3A87" />
        </svg>
        <p>This extension works best on Power Automate</p>
        <button id="open-in-powerautomate" class="primary-btn">Open in Power Automate</button>
      </div>
    </div>

    <!-- Walkthrough container -->
    <div id="walkthrough-container"></div>

  </div>

  <script src="lib/xlsx.mini.min.js"></script>
  <script src="sidepanel.js"></script>
</body>

</html>